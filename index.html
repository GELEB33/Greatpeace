<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emoji Collector</title>
    <style>
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            overflow-x: hidden;
            touch-action: manipulation;
        }
        .header {
            text-align: center;
            padding: 15px 0;
            width: 100%;
            background: rgba(0,0,0,0.3);
            margin-bottom: 15px;
            position: relative;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        h1 {
            margin: 0;
            font-size: 1.8rem;
            color: #fff;
            text-shadow: 0 2px 10px rgba(255,255,255,0.3);
            letter-spacing: 1px;
            background: linear-gradient(90deg, #f5af19, #f12711, #f5af19);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .money-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        .money-display {
            background: rgba(0,0,0,0.5);
            border-radius: 20px;
            padding: 8px 20px;
            font-size: 1.1rem;
            font-weight: bold;
            display: inline-block;
            border: 1px solid rgba(255,215,0,0.3);
            box-shadow: 0 0 15px rgba(255,215,0,0.2);
            position: relative;
        }
        .click-for-coins {
            background: rgba(255,215,0,0.2);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid rgba(255,215,0,0.5);
            transition: transform 0.2s;
        }
        .click-for-coins:active {
            transform: scale(0.9);
        }
        .main-container {
            display: flex;
            flex-direction: column;
            width: 95%;
            max-width: 500px;
            height: calc(100vh - 200px);
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            overflow: hidden;
        }
        .game-area {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            gap: 10px;
        }
        .action-button {
            background: linear-gradient(45deg, #8e2de2, #4a00e0);
            border: none;
            border-radius: 10px;
            padding: 10px 15px;
            font-size: 0.9rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.2s;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .action-button:active {
            transform: scale(0.96);
        }
        .action-button:disabled {
            background: linear-gradient(45deg, #555, #333);
            cursor: not-allowed;
            opacity: 0.7;
        }
        .free-coins-button {
            background: linear-gradient(45deg, #f5af19, #f12711);
        }
        .inventory-container {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 10px;
            flex-grow: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .inventory-title {
            font-size: 1rem;
            font-weight: bold;
            color: rgba(255,255,255,0.9);
        }
        .inventory-stats {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.7);
        }
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 10px;
            overflow-y: auto;
            flex-grow: 1;
            padding: 5px;
        }
        .item {
            font-size: 2rem;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1/1;
            position: relative;
            transition: all 0.3s;
            border: 2px solid rgba(255,255,255,0.1);
            cursor: pointer;
        }
        .item:active {
            transform: scale(0.95);
        }
        .item-value {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .item-sell {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255,0,0,0.7);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .item:hover .item-sell {
            display: flex;
        }
        .item-common { border-color: #bdc3c7; }
        .item-rare { border-color: #3498db; }
        .item-epic { border-color: #9b59b6; }
        .item-legendary { border-color: #f1c40f; }
        .item-ultra { border-color: #e74c3c; }
        .item-mythical { border-color: #1abc9c; }
        .item-unique { border-color: #FFD700; }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            background: linear-gradient(135deg, #3a3a3a 0%, #1a1a1a 100%);
            border-radius: 15px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            animation: slideUp 0.3s;
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #fff;
        }
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .close-modal:active {
            transform: scale(0.9);
        }
        .cases-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .case-item {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .case-item:active {
            transform: scale(0.97);
        }
        .case-emoji {
            font-size: 2.5rem;
            margin-bottom: 5px;
            transition: transform 0.3s;
        }
        .case-item:hover .case-emoji {
            transform: scale(1.1);
        }
        .case-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .case-price {
            color: gold;
            font-size: 0.9rem;
        }
        .case-chances {
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            background-color: #f00;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1000;
        }
        .coin {
            position: absolute;
            font-size: 1rem;
            pointer-events: none;
            z-index: 1001;
            animation: coinFly 1s forwards;
        }
        @keyframes coinFly {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }
        .rarity-info {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 0.7rem;
        }
        .rarity-tag {
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            background: rgba(0,0,0,0.4);
            transition: transform 0.2s;
        }
        .rarity-tag:active {
            transform: scale(0.95);
        }
        .common { border-left: 3px solid #bdc3c7; }
        .rare { border-left: 3px solid #3498db; }
        .epic { border-left: 3px solid #9b59b6; }
        .legendary { border-left: 3px solid #f1c40f; }
        .ultra { border-left: 3px solid #e74c3c; }
        .mythical { border-left: 3px solid #1abc9c; }
        .unique { border-left: 3px solid #FFD700; }
        .sell-confirmation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 25px;
            border-radius: 15px;
            z-index: 1002;
            border: 1px solid rgba(255,255,255,0.2);
            display: none;
            flex-direction: column;
            align-items: center;
            width: 85%;
            max-width: 350px;
            animation: fadeIn 0.3s;
        }
        .sell-confirmation-text {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.1rem;
        }
        .sell-confirmation-buttons {
            display: flex;
            gap: 10px;
            width: 100%;
        }
        .sell-confirm-btn, .sell-cancel-btn, .sell-all-btn {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            flex: 1;
            text-align: center;
        }
        .sell-confirm-btn:active, .sell-cancel-btn:active, .sell-all-btn:active {
            transform: scale(0.95);
        }
        .sell-confirm-btn {
            background: linear-gradient(45deg, #FF416C 0%, #FF4B2B 100%);
            color: white;
        }
        .sell-cancel-btn {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        .sell-all-btn {
            background: linear-gradient(45deg, #FF9500, #FF5E00);
            color: white;
            margin-top: 10px;
            width: 100%;
        }
        .timer-display {
            font-size: 0.8rem;
            margin-top: 5px;
            color: rgba(255,255,255,0.7);
        }
        .quests-container {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        .quest-item {
            margin-bottom: 15px;
        }
        .quest-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .quest-progress {
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        .quest-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #f5af19, #f12711);
            border-radius: 5px;
            transition: width 0.5s;
        }
        .quest-percentage {
            font-size: 0.8rem;
            text-align: right;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .pulse {
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Emoji Collector</h1>
        <div class="money-container">
            <div class="money-display">🪙 <span id="money">100.0</span></div>
            <div class="click-for-coins" id="clickForCoins">👆</div>
        </div>
    </div>

    <div class="main-container">
        <div class="game-area">
            <div class="action-buttons">
                <button class="action-button" id="openCasesModal">Buy Cases</button>
                <button class="action-button free-coins-button" id="freeCoinsButton">Free Coins (30🪙)</button>
                <button class="action-button" id="openQuestsModal">Quests</button>
            </div>
            
            <div class="inventory-container">
                <div class="inventory-header">
                    <div class="inventory-title">📦 Your Collection</div>
                    <div class="inventory-stats">Items: <span id="itemCount">0</span></div>
                </div>
                <div class="items-grid" id="inventory"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="casesModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">🎁 Premium Cases</div>
                <button class="close-modal" id="closeCasesModal">&times;</button>
            </div>
            <div class="cases-grid" id="casesGrid">
                <!-- Cases will be added here -->
            </div>
        </div>
    </div>

    <div class="modal" id="questsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">🏆 Quests</div>
                <button class="close-modal" id="closeQuestsModal">&times;</button>
            </div>
            <div class="quests-container">
                <div class="quest-item">
                    <div class="quest-title">Earn 1,000,000,000 coins</div>
                    <div class="quest-progress">
                        <div class="quest-progress-bar" id="moneyQuestBar"></div>
                    </div>
                    <div class="quest-percentage" id="moneyQuestPercent">0%</div>
                </div>
                <div class="quest-item">
                    <div class="quest-title">Open 1,000,000 cases</div>
                    <div class="quest-progress">
                        <div class="quest-progress-bar" id="casesQuestBar"></div>
                    </div>
                    <div class="quest-percentage" id="casesQuestPercent">0%</div>
                </div>
            </div>
        </div>
    </div>

    <div class="sell-confirmation" id="sellConfirmation">
        <div class="sell-confirmation-text" id="sellConfirmationText"></div>
        <div class="sell-confirmation-buttons">
            <button class="sell-confirm-btn" id="sellConfirmBtn">Sell</button>
            <button class="sell-cancel-btn" id="sellCancelBtn">Cancel</button>
        </div>
        <button class="sell-all-btn" id="sellAllBtn">Sell All Emojis</button>
    </div>

    <div class="rarity-info">
        <div class="rarity-tag common">Common</div>
        <div class="rarity-tag rare">Rare</div>
        <div class="rarity-tag epic">Epic</div>
        <div class="rarity-tag legendary">Legendary</div>
        <div class="rarity-tag ultra">Ultra</div>
        <div class="rarity-tag mythical">Mythical</div>
    </div>

    <script>
        // Emojis by rarity (only widely supported emojis)
        const emojis = {
            common: ['😀', '😃', '😄', '😁', '😆', '😅', '😂', '🤣', '😊', '😇'],
            rare: ['😍', '🥰', '😘', '😗', '😎', '🤓', '🧐', '🥳', '😏', '😋'],
            epic: ['🤩', '🤯', '😱', '😈', '👹', '👺', '🤡', '👻', '💀', '👽'],
            legendary: ['👑', '🎩', '🧢', '👒', '💍', '💎', '🏆', '🎖', '🥇', '🪙'],
            ultra: ['⚡', '💫', '⭐', '🌟', '✨', '🔥', '💥', '☄️', '🌪', '🌈'],
            mythical: ['🦄', '🐉', '🐲', '🦂', '🦅', '🦇', '🦉', '🦚', '🦩', '🦋'],
            unique: ['☢️', '☣️', '⚕️', '⚚', '⚠️', '♻️', '⚜️', '🔱', '✡️', '☯️']
        };
        
        // Emoji values (many will not pay for their case)
        const emojiValues = {
            common: 2,
            rare: 8,
            epic: 25,
            legendary: 80,
            ultra: 250,
            mythical: 1000,
            unique: 5000
        };
        
        // Cases (9 total cases now)
        const cases = [
            { 
                name: "Basic Case", 
                emoji: "🎁", 
                price: 15, 
                chances: { common: 80, rare: 18, epic: 2 },
                color: "common"
            },
            { 
                name: "Rare Case", 
                emoji: "📦", 
                price: 50, 
                chances: { common: 50, rare: 40, epic: 9, legendary: 1 },
                color: "rare"
            },
            { 
                name: "Epic Case", 
                emoji: "💎", 
                price: 150, 
                chances: { rare: 50, epic: 40, legendary: 9, ultra: 1 },
                color: "epic"
            },
            { 
                name: "Legendary Case", 
                emoji: "🏆", 
                price: 500, 
                chances: { epic: 50, legendary: 40, ultra: 9, mythical: 1 },
                color: "legendary"
            },
            { 
                name: "Ultra Case", 
                emoji: "⚡", 
                price: 1500, 
                chances: { legendary: 50, ultra: 40, mythical: 9, unique: 1 },
                color: "ultra"
            },
            { 
                name: "Mythical Case", 
                emoji: "🦄", 
                price: 5000, 
                chances: { ultra: 60, mythical: 35, unique: 5 },
                color: "mythical"
            },
            { 
                name: "Dragon Case", 
                emoji: "🐉", 
                price: 10000, 
                chances: { mythical: 70, unique: 30 },
                color: "unique"
            },
            { 
                name: "Phoenix Case", 
                emoji: "🔥", 
                price: 25000, 
                chances: { mythical: 30, unique: 70 },
                color: "unique"
            },
            { 
                name: "Godly Case", 
                emoji: "✨", 
                price: 50000, 
                chances: { unique: 100 },
                color: "unique"
            }
        ];
        
        // Player data
        const player = {
            money: 100,
            inventory: [],
            unopenedCases: [],
            lastFreeCoins: 0,
            totalMoneyEarned: 0,
            totalCasesOpened: 0
        };
        
        // Initialize the game
        function initGame() {
            loadGame();
            updateUI();
            updateInventory();
            initCasesModal();
            updateQuests();
            
            // Set up free coins button
            updateFreeCoinsButton();
            document.getElementById('freeCoinsButton').addEventListener('click', claimFreeCoins);
            
            // Set up click for coins button
            document.getElementById('clickForCoins').addEventListener('click', clickForCoins);
            
            // Set up quests modal
            document.getElementById('openQuestsModal').onclick = () => {
                document.getElementById('questsModal').style.display = 'flex';
            };
            document.getElementById('closeQuestsModal').onclick = () => {
                document.getElementById('questsModal').style.display = 'none';
            };
            
            // Auto-save every 30 seconds
            setInterval(saveGame, 30000);
            window.addEventListener('beforeunload', saveGame);
            
            // Sell confirmation buttons
            document.getElementById('sellConfirmBtn').onclick = confirmSell;
            document.getElementById('sellCancelBtn').onclick = cancelSell;
            document.getElementById('sellAllBtn').onclick = sellAllEmojis;
        }
        
        // Load game from localStorage
        function loadGame() {
            const savedGame = localStorage.getItem('emojiCollectorSave');
            if (savedGame) {
                const parsed = JSON.parse(savedGame);
                player.money = parsed.money || 100;
                player.inventory = parsed.inventory || [];
                player.unopenedCases = parsed.unopenedCases || [];
                player.lastFreeCoins = parsed.lastFreeCoins || 0;
                player.totalMoneyEarned = parsed.totalMoneyEarned || 0;
                player.totalCasesOpened = parsed.totalCasesOpened || 0;
            }
        }
        
        // Save game to localStorage
        function saveGame() {
            const gameData = {
                money: player.money,
                inventory: player.inventory,
                unopenedCases: player.unopenedCases,
                lastFreeCoins: player.lastFreeCoins,
                totalMoneyEarned: player.totalMoneyEarned,
                totalCasesOpened: player.totalCasesOpened
            };
            localStorage.setItem('emojiCollectorSave', JSON.stringify(gameData));
        }
        
        // Update UI
        function updateUI() {
            document.getElementById('money').textContent = player.money.toFixed(1);
            document.getElementById('itemCount').textContent = player.inventory.length + player.unopenedCases.length;
        }
        
        // Update inventory display
        function updateInventory() {
            const inventoryDiv = document.getElementById('inventory');
            inventoryDiv.innerHTML = '';
            
            // Display unopened cases first
            player.unopenedCases.forEach((caseItem, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item';
                itemDiv.innerHTML = `
                    ${caseItem.emoji}
                    <div class="item-value">${caseItem.price}🪙</div>
                `;
                itemDiv.onclick = () => openCase(index);
                inventoryDiv.appendChild(itemDiv);
            });
            
            // Then display collected emojis
            player.inventory.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = `item item-${item.rarity}`;
                itemDiv.innerHTML = `
                    ${item.emoji}
                    <div class="item-value">${item.value}🪙</div>
                    <div class="item-sell">×</div>
                `;
                itemDiv.onclick = (e) => {
                    // Check if the sell button was clicked
                    if (e.target.classList.contains('item-sell')) {
                        showSellConfirmation(index, item);
                    }
                };
                inventoryDiv.appendChild(itemDiv);
            });
        }
        
        // Initialize cases modal
        function initCasesModal() {
            const casesGrid = document.getElementById('casesGrid');
            casesGrid.innerHTML = '';
            
            cases.forEach((caseItem, index) => {
                const caseDiv = document.createElement('div');
                caseDiv.className = 'case-item';
                caseDiv.innerHTML = `
                    <div class="case-emoji">${caseItem.emoji}</div>
                    <div class="case-name">${caseItem.name}</div>
                    <div class="case-price">${caseItem.price}🪙</div>
                    <div class="case-chances">
                        ${Object.entries(caseItem.chances).map(([rarity, chance]) => 
                            `${chance}% ${rarity}`).join(', ')}
                    </div>
                `;
                caseDiv.onclick = () => buyCase(index);
                casesGrid.appendChild(caseDiv);
            });
            
            // Modal controls
            document.getElementById('openCasesModal').onclick = () => {
                document.getElementById('casesModal').style.display = 'flex';
            };
            
            document.getElementById('closeCasesModal').onclick = () => {
                document.getElementById('casesModal').style.display = 'none';
            };
        }
        
        // Buy a case
        function buyCase(caseIndex) {
            const caseItem = cases[caseIndex];
            
            if (player.money < caseItem.price) {
                alert("Not enough coins!");
                return;
            }
            
            player.money -= caseItem.price;
            player.unopenedCases.push({
                ...caseItem,
                id: Date.now()
            });
            
            updateUI();
            updateInventory();
        }
        
        // Open a case
        function openCase(caseIndex) {
            const caseItem = player.unopenedCases[caseIndex];
            
            // Determine rarity
            const random = Math.random() * 100;
            let rarity = 'common';
            let cumulative = 0;
            
            for (const [r, chance] of Object.entries(caseItem.chances)) {
                cumulative += chance;
                if (random <= cumulative) {
                    rarity = r;
                    break;
                }
            }
            
            // Get random emoji
            const emojiList = emojis[rarity];
            const emoji = emojiList[Math.floor(Math.random() * emojiList.length)];
            
            // Create item
            const item = {
                emoji,
                rarity,
                value: emojiValues[rarity]
            };
            
            // Add to inventory
            player.inventory.push(item);
            
            // Remove case
            player.unopenedCases.splice(caseIndex, 1);
            
            // Update stats
            player.totalCasesOpened++;
            player.totalMoneyEarned += item.value;
            
            // Update quests
            updateQuests();
            
            // Show confetti for rare items
            if (rarity !== 'common' && rarity !== 'rare') {
                createConfetti();
            }
            
            updateUI();
            updateInventory();
        }
        
        // Free coins system
        function updateFreeCoinsButton() {
            const button = document.getElementById('freeCoinsButton');
            const now = Date.now();
            const cooldown = 2 * 60 * 1000; // 2 minutes
            
            if (now - player.lastFreeCoins >= cooldown) {
                button.disabled = false;
                button.innerHTML = 'Free Coins (30🪙)';
            } else {
                button.disabled = true;
                const remaining = Math.ceil((cooldown - (now - player.lastFreeCoins)) / 1000);
                button.innerHTML = `Free Coins (${remaining}s)`;
            }
        }
        
        function claimFreeCoins() {
            const now = Date.now();
            const cooldown = 2 * 60 * 1000; // 2 minutes
            
            if (now - player.lastFreeCoins >= cooldown) {
                addCoins(30);
                player.lastFreeCoins = now;
                updateFreeCoinsButton();
                createConfetti();
                
                // Update button every second
                const interval = setInterval(() => {
                    updateFreeCoinsButton();
                    if (!document.getElementById('freeCoinsButton').disabled) {
                        clearInterval(interval);
                    }
                }, 1000);
            }
        }
        
        // Click for coins
        function clickForCoins() {
            addCoins(0.2);
            
            // Create flying coin animation
            const button = document.getElementById('clickForCoins');
            const rect = button.getBoundingClientRect();
            const startX = rect.left + rect.width / 2;
            const startY = rect.top + rect.height / 2;
            
            // Create 3 coins
            for (let i = 0; i < 3; i++) {
                const coin = document.createElement('div');
                coin.className = 'coin';
                coin.textContent = '🪙';
                coin.style.left = `${startX}px`;
                coin.style.top = `${startY}px`;
                
                // Random end position (toward money display)
                const endX = -50 + Math.random() * 100;
                const endY = -100 - Math.random() * 50;
                
                coin.style.setProperty('--tx', `${endX}px`);
                coin.style.setProperty('--ty', `${endY}px`);
                
                document.body.appendChild(coin);
                
                // Remove after animation
                setTimeout(() => {
                    coin.remove();
                }, 1000);
            }
        }
        
        // Add coins with animation
        function addCoins(amount) {
            player.money += amount;
            player.totalMoneyEarned += amount;
            updateUI();
            updateQuests();
        }
        
        // Update quests display
        function updateQuests() {
            // Money quest (1,000,000,000)
            const moneyPercent = Math.min(100, (player.totalMoneyEarned / 1000000000) * 100);
            document.getElementById('moneyQuestBar').style.width = `${moneyPercent}%`;
            document.getElementById('moneyQuestPercent').textContent = `${moneyPercent.toFixed(6)}%`;
            
            // Cases quest (1,000,000)
            const casesPercent = Math.min(100, (player.totalCasesOpened / 1000000) * 100);
            document.getElementById('casesQuestBar').style.width = `${casesPercent}%`;
            document.getElementById('casesQuestPercent').textContent = `${casesPercent.toFixed(4)}%`;
        }
        
        // Sell system
        let currentSellIndex = null;
        
        function showSellConfirmation(index, item) {
            currentSellIndex = index;
            document.getElementById('sellConfirmationText').innerHTML = 
                `Sell <span style="font-size:1.5em">${item.emoji}</span> for ${item.value}🪙?`;
            document.getElementById('sellConfirmation').style.display = 'flex';
        }
        
        function confirmSell() {
            if (currentSellIndex !== null) {
                const item = player.inventory[currentSellIndex];
                addCoins(item.value);
                player.inventory.splice(currentSellIndex, 1);
                updateInventory();
            }
            cancelSell();
        }
        
        function sellAllEmojis() {
            if (player.inventory.length === 0) {
                alert("You don't have any emojis to sell!");
                cancelSell();
                return;
            }
            
            const totalValue = player.inventory.reduce((sum, item) => sum + item.value, 0);
            addCoins(totalValue);
            player.inventory = [];
            updateInventory();
            cancelSell();
            createConfetti();
        }
        
        function cancelSell() {
            currentSellIndex = null;
            document.getElementById('sellConfirmation').style.display = 'none';
        }
        
        // Create confetti effect
        function createConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ff9900'];
            
            for (let i = 0; i < 20; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.top = '-10px';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = `${Math.random() * 8 + 4}px`;
                confetti.style.height = `${Math.random() * 8 + 4}px`;
                document.body.appendChild(confetti);
                
                const animationDuration = Math.random() * 2 + 1;
                confetti.style.transition = `top ${animationDuration}s linear, transform ${animationDuration}s ease-out, opacity ${animationDuration}s`;
                
                setTimeout(() => {
                    confetti.style.top = '100vh';
                    confetti.style.transform = `rotate(${Math.random() * 360}deg) translateX(${Math.random() * 100 - 50}px)`;
                    confetti.style.opacity = '0';
                }, 10);
                
                setTimeout(() => {
                    confetti.remove();
                }, animationDuration * 1000);
            }
        }
        
        // Start the game
        initGame();
        
        // Update free coins button every second
        setInterval(updateFreeCoinsButton, 1000);
    </script>
</body>
</html>
