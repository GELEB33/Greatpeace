<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üåæ –§–µ—Ä–º–∞ –ø—à–µ–Ω–∏—Ü—ã</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            touch-action: manipulation;
            user-select: none;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(#87CEEB, #E0F7FA);
            height: 100vh;
            overflow: hidden;
        }

        /* –ú–µ–Ω—é */
        .menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .menu-content {
            background: #FFECB3;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .menu-title {
            font-size: 28px;
            color: #5D4037;
            margin-bottom: 20px;
        }

        .menu-btn {
            background: #8BC34A;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 25px;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #689F38;
            width: 200px;
        }

        .menu-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .menu-btn.small {
            padding: 8px 15px;
            font-size: 14px;
            width: auto;
        }

        /* –ò–≥—Ä–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        .game-container {
            display: none;
            flex-direction: column;
            height: 100vh;
            padding: 10px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }

        .resources {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .resource {
            background: rgba(255, 255, 255, 0.7);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
        }

        .fields-container {
            position: relative;
            flex-grow: 1;
            margin: 10px 0;
            overflow: hidden;
            touch-action: pan-y;
        }

        .fields-slider {
            display: flex;
            height: 100%;
            transition: transform 0.3s ease;
            width: 100%;
        }

        .field-wrapper {
            min-width: 100%;
            height: 100%;
            position: relative;
            touch-action: none;
        }

        .field {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8D6E63 0%, #5D4037 50%, #3E2723 100%);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 0 0 4px #5D4037,
                0 0 0 8px #8D6E63,
                0 0 0 12px #A1887F,
                inset 0 0 20px rgba(0, 0, 0, 0.3);
            touch-action: none;
        }

        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 20px;
            background: linear-gradient(to top, #5D4037, #8D6E63);
        }

        .wheat {
            position: absolute;
            width: 30px;
            height: 0;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            font-size: 24px;
            transition: height 1.5s ease-out;
            z-index: 2;
            touch-action: none;
        }

        .wheat::before {
            content: "üå±";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            transition: all 1.5s;
        }

        .wheat.grown::before {
            content: "üåæ";
            transform: scale(1.5);
        }

        .tools {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .tool-btn {
            padding: 10px 15px;
            font-size: 18px;
            border: none;
            border-radius: 50px;
            background: #FFD54F;
            color: #5D4037;
            cursor: pointer;
            box-shadow: 0 4px 0 #F57F17;
            transition: all 0.1s;
            flex-grow: 1;
        }

        .tool-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .tool-btn.active {
            background: #4CAF50;
            color: white;
        }

        .status {
            padding: 10px;
            font-size: 16px;
            color: #5D4037;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            text-align: center;
            margin-bottom: 10px;
        }

        /* –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–µ–π */
        .field-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.7);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .prev-field {
            left: 5px;
        }

        .next-field {
            right: 5px;
        }

        .field-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.7);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            z-index: 5;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç—ã */
        .water-effect {
            position: absolute;
            width: 30px;
            height: 30px;
            background: rgba(100, 181, 246, 0.5);
            border-radius: 50%;
            pointer-events: none;
            animation: waterDrop 0.5s forwards;
            z-index: 3;
        }

        @keyframes waterDrop {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }

        .harvest-effect {
            position: absolute;
            font-size: 24px;
            animation: harvestAnim 1s forwards;
            pointer-events: none;
            z-index: 10;
        }

        @keyframes harvestAnim {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0.5); opacity: 0; }
        }

        /* –î–µ–∫–æ—Ä */
        .sun {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 30px;
            animation: sunPulse 5s infinite alternate;
            z-index: 1;
        }

        @keyframes sunPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .cloud {
            position: absolute;
            font-size: 25px;
            animation: cloudMove 30s linear infinite;
            z-index: 1;
        }

        @keyframes cloudMove {
            0% { transform: translateX(-100px); }
            100% { transform: translateX(500px); }
        }

        .rain {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: none;
            z-index: 2;
        }

        .rain-drop {
            position: absolute;
            width: 2px;
            height: 10px;
            background: rgba(100, 181, 246, 0.6);
            animation: rainFall 1s linear infinite;
        }

        @keyframes rainFall {
            0% { transform: translateY(-10px); }
            100% { transform: translateY(100vh); }
        }

        /* –ñ—É—á–∫–∏ */
        .bug {
            position: absolute;
            font-size: 20px;
            z-index: 3;
            cursor: pointer;
            animation: bugMove 5s linear infinite;
            touch-action: none;
        }

        @keyframes bugMove {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(20px, 10px) rotate(10deg); }
            50% { transform: translate(0, 20px) rotate(0deg); }
            75% { transform: translate(-20px, 10px) rotate(-10deg); }
        }

        /* –ú–∞–≥–∞–∑–∏–Ω */
        .shop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        .shop-content {
            background: #FFECB3;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
        }

        .shop-title {
            font-size: 24px;
            color: #5D4037;
            margin-bottom: 15px;
            text-align: center;
        }

        .shop-category {
            margin-bottom: 15px;
        }

        .category-title {
            font-size: 18px;
            color: #5D4037;
            margin-bottom: 10px;
            border-bottom: 1px solid #5D4037;
            padding-bottom: 5px;
        }

        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #5D4037;
        }

        .item-info {
            flex-grow: 1;
        }

        .item-name {
            font-weight: bold;
        }

        .item-price {
            font-size: 14px;
            color: #689F38;
        }

        .item-btn {
            background: #8BC34A;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
        }

        .item-btn:disabled {
            background: #BDBDBD;
            cursor: not-allowed;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #F44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            cursor: pointer;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0); }
        }

        .floating {
            animation: float 2s infinite ease-in-out;
        }

        /* –ü–æ–≥–æ–¥–∞ */
        .weather-icon {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            z-index: 1;
        }

        /* –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–ª–µ */
        .locked-field {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 5;
            color: white;
            font-size: 18px;
            text-align: center;
        }

        .unlock-btn {
            background: #8BC34A;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 8px 15px;
            margin-top: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
    <div class="menu" id="main-menu">
        <div class="menu-content">
            <h1 class="menu-title">üåæ –§–µ—Ä–º–∞ –ø—à–µ–Ω–∏—Ü—ã</h1>
            <button class="menu-btn floating" id="start-btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            <button class="menu-btn floating" id="continue-btn" style="display: none;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            <button class="menu-btn floating" id="music-btn">üîä –ú—É–∑—ã–∫–∞ –í–∫–ª</button>
            <button class="menu-btn floating small" id="help-btn">–ü–æ–º–æ—â—å</button>
        </div>
    </div>

    <!-- –ü–æ–º–æ—â—å -->
    <div class="menu" id="help-menu" style="display: none;">
        <div class="menu-content">
            <h1 class="menu-title">–ö–∞–∫ –∏–≥—Ä–∞—Ç—å?</h1>
            <div style="text-align: left; margin-bottom: 20px;">
                <p>1. <strong>–°–∞–∂–∞–π—Ç–µ –ø—à–µ–Ω–∏—Ü—É:</strong> –Ω–∞–∂–º–∏—Ç–µ "üå± –ü–æ—Å–∞–¥–∏—Ç—å" –∏ —Ç–∞–ø–Ω–∏—Ç–µ –ø–æ –ø–æ–ª—é</p>
                <p>2. <strong>–ü–æ–ª–∏–≤–∞–π—Ç–µ:</strong> –Ω–∞–∂–º–∏—Ç–µ "üíß –ü–æ–ª–∏—Ç—å" –∏ –ø—Ä–æ–≤–µ–¥–∏—Ç–µ –ø–æ —Ä–æ—Å—Ç–∫–∞–º</p>
                <p>3. <strong>–°–æ–±–∏—Ä–∞–π—Ç–µ —É—Ä–æ–∂–∞–π:</strong> –∫–æ–≥–¥–∞ –ø—à–µ–Ω–∏—Ü–∞ –≤—ã—Ä–∞—Å—Ç–µ—Ç, –Ω–∞–∂–º–∏—Ç–µ "‚úÇÔ∏è –°–æ–±—Ä–∞—Ç—å" –∏ –ø—Ä–æ–≤–µ–¥–∏—Ç–µ –ø–æ –∫–æ–ª–æ—Å—å—è–º</p>
                <p>4. <strong>–£–Ω–∏—á—Ç–æ–∂–∞–π—Ç–µ –∂—É—á–∫–æ–≤:</strong> –∫–ª–∏–∫–∞–π—Ç–µ –Ω–∞ –∂—É—á–∫–æ–≤ üêõ, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ —Å—ä–µ–ª–∏ –≤–∞—à —É—Ä–æ–∂–∞–π</p>
                <p>5. <strong>–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –¥–µ–Ω—å–≥–∏:</strong> –ø—Ä–æ–¥–∞–≤–∞–π—Ç–µ –∑–µ—Ä–Ω–æ –≤ –º–∞–≥–∞–∑–∏–Ω–µ</p>
                <p>6. <strong>–£–ª—É—á—à–∞–π—Ç–µ —Ñ–µ—Ä–º—É:</strong> –ø–æ–∫—É–ø–∞–π—Ç–µ –±–æ–ª—å—à–µ —Å–µ–º—è–Ω, –≤–æ–¥—ã –∏ –Ω–æ–≤—ã–µ –ø–æ–ª—è</p>
                <p>7. <strong>–ü–µ—Ä–µ–∫–ª—é—á–∞–π—Ç–µ –ø–æ–ª—è:</strong> –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –ø–æ –±–æ–∫–∞–º —ç–∫—Ä–∞–Ω–∞</p>
            </div>
            <button class="menu-btn" id="back-btn">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <div class="game-container" id="game-container">
        <div class="header">
            <div class="resources">
                <div class="resource">üí∞ <span id="money">100</span> —Ä—É–±.</div>
                <div class="resource">üåæ <span id="grain">0</span> –∑–µ—Ä–Ω–∞</div>
                <div class="resource">üå± <span id="seeds">5</span> —Å–µ–º—è–Ω</div>
                <div class="resource">üíß <span id="water">10</span> –ª.</div>
                <div class="resource">‚úÇÔ∏è <span id="sickle">100</span>%</div>
            </div>
            <button class="menu-btn small" id="open-shop">–ú–∞–≥–∞–∑–∏–Ω</button>
        </div>

        <div class="status" id="status">–ù–∞–∂–º–∏—Ç–µ "üå± –ü–æ—Å–∞–¥–∏—Ç—å" –∏ —Ç–∞–ø–Ω–∏—Ç–µ –ø–æ –ø–æ–ª—é</div>

        <div class="fields-container" id="fields-container">
            <button class="field-nav prev-field" id="prev-field">‚óÑ</button>
            <button class="field-nav next-field" id="next-field">‚ñ∫</button>
            
            <div class="fields-slider" id="fields-slider">
                <!-- –ü–æ–ª—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>
        </div>

        <div class="tools">
            <button class="tool-btn" id="plant-btn">üå± –ü–æ—Å–∞–¥–∏—Ç—å</button>
            <button class="tool-btn" id="water-btn">üíß –ü–æ–ª–∏—Ç—å</button>
            <button class="tool-btn" id="sickle-btn">‚úÇÔ∏è –°–æ–±—Ä–∞—Ç—å</button>
        </div>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω -->
    <div class="shop" id="shop">
        <div class="shop-content">
            <h2 class="shop-title">üè™ –ú–∞–≥–∞–∑–∏–Ω —Ñ–µ—Ä–º–µ—Ä–∞</h2>
            
            <div class="shop-category">
                <h3 class="category-title">–°–µ–º–µ–Ω–∞ –∏ –≤–æ–¥–∞</h3>
                <div class="shop-item">
                    <div class="item-info">
                        <div class="item-name">–ü–∞–∫–µ—Ç —Å–µ–º—è–Ω (5 —à—Ç.)</div>
                        <div class="item-price">üí∞ 20 —Ä—É–±.</div>
                    </div>
                    <button class="item-btn" id="buy-seeds-btn">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="shop-item">
                    <div class="item-info">
                        <div class="item-name">–ö–∞–Ω–∏—Å—Ç—Ä–∞ –≤–æ–¥—ã (10 –ª.)</div>
                        <div class="item-price">üí∞ 15 —Ä—É–±.</div>
                    </div>
                    <button class="item-btn" id="buy-water-btn">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="shop-category">
                <h3 class="category-title">–ü—Ä–æ–¥–∞–∂–∞</h3>
                <div class="shop-item">
                    <div class="item-info">
                        <div class="item-name">–ü—Ä–æ–¥–∞—Ç—å –∑–µ—Ä–Ω–æ (1 —à—Ç.)</div>
                        <div class="item-price">üí∞ 5 —Ä—É–±.</div>
                    </div>
                    <button class="item-btn" id="sell-grain-btn">–ü—Ä–æ–¥–∞—Ç—å</button>
                </div>
                <div class="shop-item">
                    <div class="item-info">
                        <div class="item-name">–ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë –∑–µ—Ä–Ω–æ (<span id="total-grain">0</span> —à—Ç.)</div>
                        <div class="item-price">üí∞ <span id="total-price">0</span> —Ä—É–±.</div>
                    </div>
                    <button class="item-btn" id="sell-all-btn">–ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë</button>
                </div>
            </div>
            
            <div class="shop-category">
                <h3 class="category-title">–£–ª—É—á—à–µ–Ω–∏—è</h3>
                <div class="shop-item">
                    <div class="item-info">
                        <div class="item-name">–ù–æ–≤—ã–π —Å–µ—Ä–ø (+50% –ø—Ä–æ—á–Ω–æ—Å—Ç–∏)</div>
                        <div class="item-price">üí∞ 80 —Ä—É–±.</div>
                    </div>
                    <button class="item-btn" id="upgrade-sickle-btn">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="shop-item">
                    <div class="item-info">
                        <div class="item-name">–ó–∞–±–æ—Ä –æ—Ç –∂—É—á–∫–æ–≤</div>
                        <div class="item-price">üí∞ 150 —Ä—É–±.</div>
                    </div>
                    <button class="item-btn" id="buy-fence-btn">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="shop-category">
                <h3 class="category-title">–ù–æ–≤—ã–µ –ø–æ–ª—è</h3>
                <div class="shop-item">
                    <div class="item-info">
                        <div class="item-name">–ü–æ–ª–µ ‚Ññ2 (40 —Ä–∞—Å—Ç–µ–Ω–∏–π)</div>
                        <div class="item-price">üí∞ 200 —Ä—É–±.</div>
                    </div>
                    <button class="item-btn" id="buy-field2-btn">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="shop-item">
                    <div class="item-info">
                        <div class="item-name">–ü–æ–ª–µ ‚Ññ3 (60 —Ä–∞—Å—Ç–µ–Ω–∏–π)</div>
                        <div class="item-price">üí∞ 400 —Ä—É–±.</div>
                    </div>
                    <button class="item-btn" id="buy-field3-btn">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="shop-item">
                    <div class="item-info">
                        <div class="item-name">–ü–æ–ª–µ ‚Ññ4 (80 —Ä–∞—Å—Ç–µ–Ω–∏–π)</div>
                        <div class="item-price">üí∞ 600 —Ä—É–±.</div>
                    </div>
                    <button class="item-btn" id="buy-field4-btn">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="shop-item">
                    <div class="item-info">
                        <div class="item-name">–ü–æ–ª–µ ‚Ññ5 (100 —Ä–∞—Å—Ç–µ–Ω–∏–π)</div>
                        <div class="item-price">üí∞ 800 —Ä—É–±.</div>
                    </div>
                    <button class="item-btn" id="buy-field5-btn">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
        </div>
        <button class="close-btn" id="close-shop-btn">‚úï</button>
    </div>

    <!-- –ê—É–¥–∏–æ -->
    <audio id="bg-music" loop>
        <source src="https://assets.mixkit.co/music/preview/mixkit-farming-2083.mp3" type="audio/mpeg">
    </audio>
    <audio id="water-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3" type="audio/mpeg">
    </audio>
    <audio id="harvest-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="plant-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-quick-jump-arcade-game-239.mp3" type="audio/mpeg">
    </audio>
    <audio id="coin-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-coins-handling-1939.mp3" type="audio/mpeg">
    </audio>
    <audio id="bug-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-creature-squeak-1023.mp3" type="audio/mpeg">
    </audio>
    <audio id="rain-sound" loop>
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-rain-loop-1246.mp3" type="audio/mpeg">
    </audio>

    <script>
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        const gameState = {
            money: 100,
            grain: 0,
            seeds: 5,
            water: 10,
            sickleDurability: 100,
            musicOn: false,
            gameStarted: false,
            hasFence: false,
            weather: 'sunny',
            bugs: [],
            unlockedFields: 1, // –ù–∞—á–∏–Ω–∞–µ–º —Å 1 –ø–æ–ª—è
            currentField: 0,
            fields: [
                { maxPlants: 30, plants: [], bugs: [] },
                { maxPlants: 40, plants: [], bugs: [], locked: true },
                { maxPlants: 60, plants: [], bugs: [], locked: true },
                { maxPlants: 80, plants: [], bugs: [], locked: true },
                { maxPlants: 100, plants: [], bugs: [], locked: true }
            ]
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const mainMenu = document.getElementById('main-menu');
        const helpMenu = document.getElementById('help-menu');
        const gameContainer = document.getElementById('game-container');
        const shop = document.getElementById('shop');
        const fieldsContainer = document.getElementById('fields-container');
        const fieldsSlider = document.getElementById('fields-slider');
        const prevFieldBtn = document.getElementById('prev-field');
        const nextFieldBtn = document.getElementById('next-field');
        
        // –ö–Ω–æ–ø–∫–∏
        const startBtn = document.getElementById('start-btn');
        const continueBtn = document.getElementById('continue-btn');
        const helpBtn = document.getElementById('help-btn');
        const backBtn = document.getElementById('back-btn');
        const musicBtn = document.getElementById('music-btn');
        const openShopBtn = document.getElementById('open-shop');
        const closeShopBtn = document.getElementById('close-shop-btn');
        const plantBtn = document.getElementById('plant-btn');
        const waterBtn = document.getElementById('water-btn');
        const sickleBtn = document.getElementById('sickle-btn');
        
        // –ú–∞–≥–∞–∑–∏–Ω
        const buySeedsBtn = document.getElementById('buy-seeds-btn');
        const buyWaterBtn = document.getElementById('buy-water-btn');
        const sellGrainBtn = document.getElementById('sell-grain-btn');
        const sellAllBtn = document.getElementById('sell-all-btn');
        const upgradeSickleBtn = document.getElementById('upgrade-sickle-btn');
        const buyFenceBtn = document.getElementById('buy-fence-btn');
        const buyField2Btn = document.getElementById('buy-field2-btn');
        const buyField3Btn = document.getElementById('buy-field3-btn');
        const buyField4Btn = document.getElementById('buy-field4-btn');
        const buyField5Btn = document.getElementById('buy-field5-btn');
        
        // –ê—É–¥–∏–æ
        const bgMusic = document.getElementById('bg-music');
        const waterSound = document.getElementById('water-sound');
        const harvestSound = document.getElementById('harvest-sound');
        const plantSound = document.getElementById('plant-sound');
        const coinSound = document.getElementById('coin-sound');
        const bugSound = document.getElementById('bug-sound');
        const rainSound = document.getElementById('rain-sound');
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let activeTool = null;
        const gridSize = 40; // –†–∞–∑–º–µ—Ä –∫–ª–µ—Ç–∫–∏ –¥–ª—è –ø–æ—Å–∞–¥–∫–∏
        let lastBugSpawnTime = 0;
        let weatherChangeTimer;
        let fieldsElements = [];
        let isDragging = false;
        let startX = 0;
        let currentTranslate = 0;
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–µ–π
        function createFields() {
            fieldsSlider.innerHTML = '';
            fieldsElements = [];
            
            for (let i = 0; i < 5; i++) {
                const fieldWrapper = document.createElement('div');
                fieldWrapper.className = 'field-wrapper';
                
                const field = document.createElement('div');
                field.className = 'field';
                field.dataset.index = i;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–∫–æ—Ä
                const weatherIcon = document.createElement('div');
                weatherIcon.className = 'weather-icon';
                weatherIcon.textContent = '‚òÄÔ∏è';
                field.appendChild(weatherIcon);
                
                const sun = document.createElement('div');
                sun.className = 'sun';
                sun.textContent = '‚òÄÔ∏è';
                field.appendChild(sun);
                
                const cloud1 = document.createElement('div');
                cloud1.className = 'cloud';
                cloud1.style.top = '20px';
                cloud1.textContent = '‚òÅÔ∏è';
                field.appendChild(cloud1);
                
                const cloud2 = document.createElement('div');
                cloud2.className = 'cloud';
                cloud2.style.top = '60px';
                cloud2.style.animationDelay = '-10s';
                cloud2.textContent = '‚òÅÔ∏è';
                field.appendChild(cloud2);
                
                const rain = document.createElement('div');
                rain.className = 'rain';
                rain.id = `rain-${i}`;
                field.appendChild(rain);
                
                const ground = document.createElement('div');
                ground.className = 'ground';
                field.appendChild(ground);
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª–µ
                const fieldInfo = document.createElement('div');
                fieldInfo.className = 'field-info';
                fieldInfo.textContent = `–ü–æ–ª–µ ${i+1} (${gameState.fields[i].plants.length}/${gameState.fields[i].maxPlants})`;
                field.appendChild(fieldInfo);
                
                // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–ª–µ
                if (i > 0 && gameState.fields[i].locked) {
                    const lockedField = document.createElement('div');
                    lockedField.className = 'locked-field';
                    lockedField.innerHTML = `–ü–æ–ª–µ ${i+1}<br>–ú–∞–∫—Å. —Ä–∞—Å—Ç–µ–Ω–∏–π: ${gameState.fields[i].maxPlants}<br><br>`;
                    
                    const unlockBtn = document.createElement('button');
                    unlockBtn.className = 'unlock-btn';
                    unlockBtn.textContent = `–ö—É–ø–∏—Ç—å –∑–∞ ${getFieldPrice(i)} —Ä—É–±.`;
                    unlockBtn.addEventListener('click', () => buyField(i));
                    lockedField.appendChild(unlockBtn);
                    
                    field.appendChild(lockedField);
                }
                
                fieldWrapper.appendChild(field);
                fieldsSlider.appendChild(fieldWrapper);
                fieldsElements.push(field);
            }
            
            updateFieldsPosition();
            restorePlants();
        }
        
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏–π –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
        function restorePlants() {
            gameState.fields.forEach((field, fieldIndex) => {
                field.plants.forEach(plant => {
                    const wheat = document.createElement('div');
                    wheat.className = 'wheat';
                    wheat.style.left = plant.left;
                    wheat.style.bottom = plant.bottom;
                    
                    if (plant.grown) {
                        wheat.style.height = '100px';
                        wheat.classList.add('grown');
                    }
                    
                    fieldsElements[fieldIndex].appendChild(wheat);
                    plant.element = wheat;
                });
            });
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã –ø–æ–ª—è
        function getFieldPrice(index) {
            const prices = [0, 200, 400, 600, 800];
            return prices[index];
        }
        
        // –ü–æ–∫—É–ø–∫–∞ –ø–æ–ª—è
        function buyField(index) {
            const price = getFieldPrice(index);
            if (gameState.money >= price) {
                gameState.money -= price;
                gameState.fields[index].locked = false;
                gameState.unlockedFields++;
                
                coinSound.currentTime = 0;
                coinSound.play();
                showMessage(`–ü–æ–ª–µ ${index+1} –∫—É–ø–ª–µ–Ω–æ!`);
                updateUI();
                createFields();
                saveGame();
            } else {
                showMessage("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!");
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å–ª–∞–π–¥–µ—Ä–∞ –ø–æ–ª–µ–π
        function updateFieldsPosition() {
            fieldsSlider.style.transform = `translateX(-${gameState.currentField * 100}%)`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            prevFieldBtn.style.display = gameState.currentField > 0 ? 'flex' : 'none';
            nextFieldBtn.style.display = gameState.currentField < gameState.unlockedFields - 1 ? 'flex' : 'none';
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
        function loadGame() {
            const savedGame = localStorage.getItem('wheatFarmGame');
            if (savedGame) {
                const parsed = JSON.parse(savedGame);
                Object.assign(gameState, parsed);
                
                // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π
                const savedFields = localStorage.getItem('wheatFarmFields');
                if (savedFields) {
                    const fieldsData = JSON.parse(savedFields);
                    gameState.fields = fieldsData;
                }
                
                updateUI();
                continueBtn.style.display = 'block';
                createFields();
            } else {
                continueBtn.style.display = 'none';
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        function saveGame() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ä–∞—Å—Ç–µ–Ω–∏—è—Ö
            const fieldsToSave = gameState.fields.map(field => {
                return {
                    ...field,
                    plants: field.plants.map(plant => ({
                        left: plant.left,
                        bottom: plant.bottom,
                        grown: plant.grown,
                        position: plant.position
                    })),
                    bugs: [] // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∂—É—á–∫–æ–≤
                };
            });
            
            localStorage.setItem('wheatFarmGame', JSON.stringify({
                ...gameState,
                fields: fieldsToSave
            }));
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            document.getElementById('money').textContent = gameState.money;
            document.getElementById('grain').textContent = gameState.grain;
            document.getElementById('seeds').textContent = gameState.seeds;
            document.getElementById('water').textContent = gameState.water;
            document.getElementById('sickle').textContent = gameState.sickleDurability;
            document.getElementById('total-grain').textContent = gameState.grain;
            document.getElementById('total-price').textContent = gameState.grain * 5;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—è—Ö
            fieldsElements.forEach((field, index) => {
                const fieldInfo = field.querySelector('.field-info');
                if (fieldInfo) {
                    fieldInfo.textContent = `–ü–æ–ª–µ ${index+1} (${gameState.fields[index].plants.length}/${gameState.fields[index].maxPlants})`;
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ–∫—É–ø–æ–∫
            buySeedsBtn.disabled = gameState.money < 20;
            buyWaterBtn.disabled = gameState.money < 15;
            sellGrainBtn.disabled = gameState.grain < 1;
            sellAllBtn.disabled = gameState.grain < 1;
            upgradeSickleBtn.disabled = gameState.money < 80 || gameState.sickleDurability >= 200;
            buyFenceBtn.disabled = gameState.money < 150 || gameState.hasFence;
            buyFenceBtn.textContent = gameState.hasFence ? "–ö—É–ø–ª–µ–Ω–æ" : "–ö—É–ø–∏—Ç—å";
            
            buyField2Btn.disabled = gameState.money < 200 || !gameState.fields[1].locked;
            buyField2Btn.textContent = gameState.fields[1].locked ? "–ö—É–ø–∏—Ç—å" : "–ö—É–ø–ª–µ–Ω–æ";
            
            buyField3Btn.disabled = gameState.money < 400 || !gameState.fields[2].locked;
            buyField3Btn.textContent = gameState.fields[2].locked ? "–ö—É–ø–∏—Ç—å" : "–ö—É–ø–ª–µ–Ω–æ";
            
            buyField4Btn.disabled = gameState.money < 600 || !gameState.fields[3].locked;
            buyField4Btn.textContent = gameState.fields[3].locked ? "–ö—É–ø–∏—Ç—å" : "–ö—É–ø–ª–µ–Ω–æ";
            
            buyField5Btn.disabled = gameState.money < 800 || !gameState.fields[4].locked;
            buyField5Btn.textContent = gameState.fields[4].locked ? "–ö—É–ø–∏—Ç—å" : "–ö—É–ø–ª–µ–Ω–æ";
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—à–µ–Ω–∏—Ü—ã
        function createWheat(x, y) {
            const currentField = gameState.fields[gameState.currentField];
            
            if (gameState.seeds <= 0) {
                showMessage("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–µ–º—è–Ω!");
                return null;
            }
            
            if (currentField.plants.length >= currentField.maxPlants) {
                showMessage("–ù–∞ —ç—Ç–æ–º –ø–æ–ª–µ –Ω–µ—Ç –º–µ—Å—Ç–∞!");
                return null;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç—å –º–µ—Å—Ç–∞
            const gridX = Math.floor(x / gridSize);
            const gridY = Math.floor(y / gridSize);
            const positionKey = `${gridX},${gridY}`;
            
            if (currentField.plants.some(plant => plant.position === positionKey)) {
                return null; // –ú–µ—Å—Ç–æ —É–∂–µ –∑–∞–Ω—è—Ç–æ
            }
            
            gameState.seeds--;
            plantSound.currentTime = 0;
            plantSound.play();
            
            const left = `${gridX * gridSize}px`;
            const bottom = `${gridY * gridSize + 20}px`;
            
            const wheat = document.createElement('div');
            wheat.className = 'wheat';
            wheat.style.left = left;
            wheat.style.bottom = bottom;
            
            fieldsElements[gameState.currentField].appendChild(wheat);
            currentField.plants.push({
                element: wheat,
                position: positionKey,
                grown: false,
                left: left,
                bottom: bottom
            });
            
            updateUI();
            saveGame();
            
            // –®–∞–Ω—Å –ø–æ—è–≤–ª–µ–Ω–∏—è –∂—É—á–∫–∞ –ø—Ä–∏ –ø–æ—Å–∞–¥–∫–µ
            if (!gameState.hasFence && Math.random() < 0.2) {
                spawnBug();
            }
            
            return wheat;
        }
        
        // –ü–æ–ª–∏–≤ –ø—à–µ–Ω–∏—Ü—ã
        function waterWheat(wheat) {
            if (gameState.water <= 0) {
                showMessage("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–æ–¥—ã!");
                return false;
            }
            
            const currentField = gameState.fields[gameState.currentField];
            const plant = currentField.plants.find(p => p.element === wheat);
            
            if (!plant || plant.grown) return false;
            
            gameState.water--;
            waterSound.currentTime = 0;
            waterSound.play();
            
            wheat.style.height = '100px';
            setTimeout(() => {
                wheat.classList.add('grown');
                plant.grown = true;
                gameState.grain++;
                updateUI();
                saveGame();
            }, 1500);
            
            return true;
        }
        
        // –°–±–æ—Ä —É—Ä–æ–∂–∞—è
        function harvestWheat(wheat) {
            if (gameState.sickleDurability <= 0) {
                showMessage("–°–µ—Ä–ø —Å–ª–æ–º–∞–Ω! –ö—É–ø–∏—Ç–µ –Ω–æ–≤—ã–π.");
                return false;
            }
            
            const currentField = gameState.fields[gameState.currentField];
            const plantIndex = currentField.plants.findIndex(p => p.element === wheat);
            
            if (plantIndex === -1 || !currentField.plants[plantIndex].grown) return false;
            
            gameState.sickleDurability -= 5;
            if (gameState.sickleDurability < 0) gameState.sickleDurability = 0;
            
            harvestSound.currentTime = 0;
            harvestSound.play();
            
            // –≠—Ñ—Ñ–µ–∫—Ç —Å–±–æ—Ä–∞
            const rect = wheat.getBoundingClientRect();
            const fieldRect = fieldsElements[gameState.currentField].getBoundingClientRect();
            const effect = document.createElement('div');
            effect.className = 'harvest-effect';
            effect.textContent = 'üåæ';
            effect.style.left = `${rect.left - fieldRect.left + 15}px`;
            effect.style.top = `${rect.top - fieldRect.top}px`;
            fieldsElements[gameState.currentField].appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 1000);
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –ø—à–µ–Ω–∏—Ü—ã
            currentField.plants.splice(plantIndex, 1);
            
            wheat.style.height = '0';
            wheat.classList.remove('grown');
            setTimeout(() => {
                wheat.remove();
                updateUI();
                saveGame();
            }, 500);
            
            return true;
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –≤–æ–¥—ã
        function createWaterEffect(x, y, fieldIndex) {
            const effect = document.createElement('div');
            effect.className = 'water-effect';
            effect.style.left = `${x - 15}px`;
            effect.style.top = `${y - 15}px`;
            fieldsElements[fieldIndex].appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 500);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text) {
            const status = document.getElementById('status');
            status.textContent = text;
            setTimeout(() => {
                if (activeTool === 'plant') {
                    status.textContent = "–ù–∞–∂–º–∏—Ç–µ 'üå± –ü–æ—Å–∞–¥–∏—Ç—å' –∏ —Ç–∞–ø–Ω–∏—Ç–µ –ø–æ –ø–æ–ª—é";
                } else if (activeTool === 'water') {
                    status.textContent = "–ù–∞–∂–º–∏—Ç–µ 'üíß –ü–æ–ª–∏—Ç—å' –∏ –ø—Ä–æ–≤–µ–¥–∏—Ç–µ –ø–æ —Ä–æ—Å—Ç–∫–∞–º";
                } else if (activeTool === 'sickle') {
                    status.textContent = "–ù–∞–∂–º–∏—Ç–µ '‚úÇÔ∏è –°–æ–±—Ä–∞—Ç—å' –∏ –ø—Ä–æ–≤–µ–¥–∏—Ç–µ –ø–æ –∫–æ–ª–æ—Å—å—è–º";
                } else {
                    status.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç";
                }
            }, 2000);
        }
        
        // –£–ª—É—á—à–µ–Ω–∏–µ —Å–µ—Ä–ø–∞
        function upgradeSickle() {
            if (gameState.money < 80 || gameState.sickleDurability >= 200) return;
            
            gameState.money -= 80;
            gameState.sickleDurability += 50;
            if (gameState.sickleDurability > 200) gameState.sickleDurability = 200;
            
            coinSound.currentTime = 0;
            coinSound.play();
            showMessage("–°–µ—Ä–ø —É–ª—É—á—à–µ–Ω!");
            updateUI();
            saveGame();
        }
        
        // –ü–æ–∫—É–ø–∫–∞ –∑–∞–±–æ—Ä–∞
        function buyFence() {
            if (gameState.money < 150 || gameState.hasFence) return;
            
            gameState.money -= 150;
            gameState.hasFence = true;
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ—Ö –∂—É—á–∫–æ–≤
            gameState.fields.forEach(field => {
                field.bugs.forEach(bug => {
                    if (bug.element && bug.element.parentNode) {
                        bug.element.remove();
                    }
                });
                field.bugs = [];
            });
            
            coinSound.currentTime = 0;
            coinSound.play();
            showMessage("–ó–∞–±–æ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! –ñ—É—á–∫–∏ –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤—è—Ç—Å—è.");
            updateUI();
            saveGame();
        }
        
        // –°–ø–∞–≤–Ω –∂—É—á–∫–∞
        function spawnBug() {
            if (gameState.hasFence) return;
            
            const now = Date.now();
            if (now - lastBugSpawnTime < 10000) return; // –ù–µ —á–∞—â–µ —á–µ–º —Ä–∞–∑ –≤ 10 —Å–µ–∫—É–Ω–¥
            
            lastBugSpawnTime = now;
            const currentField = gameState.fields[gameState.currentField];
            
            const bug = document.createElement('div');
            bug.className = 'bug';
            bug.textContent = 'üêõ';
            bug.style.left = `${Math.random() * 80 + 10}%`;
            bug.style.top = `${Math.random() * 50 + 30}%`;
            
            // –°–ª—É—á–∞–π–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏
            const duration = 3 + Math.random() * 4;
            bug.style.animationDuration = `${duration}s`;
            
            bug.addEventListener('click', () => {
                bugSound.currentTime = 0;
                bugSound.play();
                bug.remove();
                
                // –£–¥–∞–ª–∏—Ç—å –∏–∑ –º–∞—Å—Å–∏–≤–∞ –∂—É—á–∫–æ–≤
                const index = currentField.bugs.findIndex(b => b.element === bug);
                if (index !== -1) {
                    currentField.bugs.splice(index, 1);
                }
                
                // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –∂—É—á–∫–∞
                gameState.money += 2;
                updateUI();
                saveGame();
            });
            
            fieldsElements[gameState.currentField].appendChild(bug);
            currentField.bugs.push({
                element: bug,
                spawnTime: now
            });
            
            // –ñ—É—á–æ–∫ –º–æ–∂–µ—Ç —Å—ä–µ—Å—Ç—å –ø—à–µ–Ω–∏—Ü—É
            setTimeout(() => {
                if (bug.parentNode && currentField.plants.length > 0) {
                    const randomIndex = Math.floor(Math.random() * currentField.plants.length);
                    const plant = currentField.plants[randomIndex];
                    
                    if (plant && plant.element) {
                        plant.element.style.height = '0';
                        plant.element.classList.remove('grown');
                        
                        setTimeout(() => {
                            if (plant.element && plant.element.parentNode) {
                                plant.element.remove();
                            }
                            currentField.plants.splice(randomIndex, 1);
                            updateUI();
                            saveGame();
                            showMessage("–ñ—É—á–æ–∫ —Å—ä–µ–ª –≤–∞—à—É –ø—à–µ–Ω–∏—Ü—É!");
                        }, 500);
                    }
                }
                
                if (bug.parentNode) {
                    bug.remove();
                    const bugIndex = currentField.bugs.findIndex(b => b.element === bug);
                    if (bugIndex !== -1) {
                        currentField.bugs.splice(bugIndex, 1);
                    }
                }
            }, 15000); // –ß–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥ –∂—É—á–æ–∫ —Å—ä–µ–¥–∞–µ—Ç –ø—à–µ–Ω–∏—Ü—É
        }
        
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã
        function changeWeather() {
            const weatherTypes = ['sunny', 'rainy'];
            const newWeather = weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
            
            if (newWeather === gameState.weather) return;
            
            gameState.weather = newWeather;
            
            fieldsElements.forEach((field, index) => {
                const weatherIcon = field.querySelector('.weather-icon');
                const rain = field.querySelector('.rain');
                
                if (newWeather === 'rainy') {
                    weatherIcon.textContent = 'üåßÔ∏è';
                    rain.style.display = 'block';
                    
                    // –°–æ–∑–¥–∞–µ–º –∫–∞–ø–ª–∏ –¥–æ–∂–¥—è
                    rain.innerHTML = '';
                    for (let i = 0; i < 30; i++) {
                        const drop = document.createElement('div');
                        drop.className = 'rain-drop';
                        drop.style.left = `${Math.random() * 100}%`;
                        drop.style.animationDelay = `${Math.random() * 2}s`;
                        rain.appendChild(drop);
                    }
                    
                    // –î–æ–∂–¥—å –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞—Å—Ç–µ–Ω–∏—è–º
                    gameState.fields[index].plants.forEach(plant => {
                        if (!plant.grown && Math.random() < 0.3) {
                            plant.element.style.height = '100px';
                            setTimeout(() => {
                                plant.element.classList.add('grown');
                                plant.grown = true;
                                gameState.grain++;
                                updateUI();
                                saveGame();
                            }, 1500);
                        }
                    });
                } else {
                    weatherIcon.textContent = '‚òÄÔ∏è';
                    rain.style.display = 'none';
                }
            });
            
            if (newWeather === 'rainy') {
                rainSound.currentTime = 0;
                rainSound.play();
            } else {
                rainSound.pause();
            }
            
            // –°–ª–µ–¥—É—é—â–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã —á–µ—Ä–µ–∑ 1-3 –º–∏–Ω—É—Ç—ã
            clearTimeout(weatherChangeTimer);
            weatherChangeTimer = setTimeout(changeWeather, 60000 + Math.random() * 120000);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        startBtn.addEventListener('click', () => {
            // –°–±—Ä–æ—Å –∏–≥—Ä—ã
            gameState.money = 100;
            gameState.grain = 0;
            gameState.seeds = 5;
            gameState.water = 10;
            gameState.sickleDurability = 100;
            gameState.gameStarted = true;
            gameState.hasFence = false;
            gameState.weather = 'sunny';
            gameState.unlockedFields = 1;
            gameState.currentField = 0;
            gameState.fields = [
                { maxPlants: 30, plants: [], bugs: [] },
                { maxPlants: 40, plants: [], bugs: [], locked: true },
                { maxPlants: 60, plants: [], bugs: [], locked: true },
                { maxPlants: 80, plants: [], bugs: [], locked: true },
                { maxPlants: 100, plants: [], bugs: [], locked: true }
            ];
            
            mainMenu.style.display = 'none';
            gameContainer.style.display = 'flex';
            createFields();
            updateUI();
            saveGame();
            
            // –ó–∞–ø—É—Å–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã
            changeWeather();
        });
        
        continueBtn.addEventListener('click', () => {
            mainMenu.style.display = 'none';
            gameContainer.style.display = 'flex';
            gameState.gameStarted = true;
            
            // –ó–∞–ø—É—Å–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã
            changeWeather();
        });
        
        helpBtn.addEventListener('click', () => {
            mainMenu.style.display = 'none';
            helpMenu.style.display = 'flex';
        });
        
        backBtn.addEventListener('click', () => {
            helpMenu.style.display = 'none';
            mainMenu.style.display = 'flex';
        });
        
        musicBtn.addEventListener('click', () => {
            gameState.musicOn = !gameState.musicOn;
            if (gameState.musicOn) {
                bgMusic.play();
                musicBtn.textContent = 'üîä –ú—É–∑—ã–∫–∞ –í–∫–ª';
            } else {
                bgMusic.pause();
                musicBtn.textContent = 'üîá –ú—É–∑—ã–∫–∞ –í—ã–∫–ª';
            }
            saveGame();
        });
        
        openShopBtn.addEventListener('click', () => {
            shop.style.display = 'flex';
        });
        
        closeShopBtn.addEventListener('click', () => {
            shop.style.display = 'none';
        });
        
        plantBtn.addEventListener('click', () => {
            activeTool = 'plant';
            plantBtn.classList.add('active');
            waterBtn.classList.remove('active');
            sickleBtn.classList.remove('active');
            showMessage("–¢–∞–ø–Ω–∏—Ç–µ –ø–æ –ø–æ–ª—é, —á—Ç–æ–±—ã –ø–æ—Å–∞–¥–∏—Ç—å –ø—à–µ–Ω–∏—Ü—É");
        });
        
        waterBtn.addEventListener('click', () => {
            activeTool = 'water';
            waterBtn.classList.add('active');
            plantBtn.classList.remove('active');
            sickleBtn.classList.remove('active');
            showMessage("–ü—Ä–æ–≤–µ–¥–∏—Ç–µ –ø–∞–ª—å—Ü–µ–º –ø–æ —Ä–æ—Å—Ç–∫–∞–º, —á—Ç–æ–±—ã –ø–æ–ª–∏—Ç—å");
        });
        
        sickleBtn.addEventListener('click', () => {
            activeTool = 'sickle';
            sickleBtn.classList.add('active');
            plantBtn.classList.remove('active');
            waterBtn.classList.remove('active');
            showMessage("–ü—Ä–æ–≤–µ–¥–∏—Ç–µ –ø–æ –∫–æ–ª–æ—Å—å—è–º, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å —É—Ä–æ–∂–∞–π");
        });
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø–æ–ª—è–º
        prevFieldBtn.addEventListener('click', () => {
            if (gameState.currentField > 0) {
                gameState.currentField--;
                updateFieldsPosition();
            }
        });
        
        nextFieldBtn.addEventListener('click', () => {
            if (gameState.currentField < gameState.unlockedFields - 1) {
                gameState.currentField++;
                updateFieldsPosition();
            }
        });
        
        // –ú–∞–≥–∞–∑–∏–Ω
        buySeedsBtn.addEventListener('click', () => {
            if (gameState.money >= 20) {
                gameState.money -= 20;
                gameState.seeds += 5;
                coinSound.currentTime = 0;
                coinSound.play();
                updateUI();
                saveGame();
                showMessage("–ö—É–ø–ª–µ–Ω–æ 5 —Å–µ–º—è–Ω");
            }
        });
        
        buyWaterBtn.addEventListener('click', () => {
            if (gameState.money >= 15) {
                gameState.money -= 15;
                gameState.water += 10;
                coinSound.currentTime = 0;
                coinSound.play();
                updateUI();
                saveGame();
                showMessage("–ö—É–ø–ª–µ–Ω–æ 10 –ª–∏—Ç—Ä–æ–≤ –≤–æ–¥—ã");
            }
        });
        
        sellGrainBtn.addEventListener('click', () => {
            if (gameState.grain >= 1) {
                gameState.grain--;
                gameState.money += 5;
                coinSound.currentTime = 0;
                coinSound.play();
                updateUI();
                saveGame();
                showMessage("–ü—Ä–æ–¥–∞–Ω–æ 1 –∑–µ—Ä–Ω–æ –∑–∞ 5 —Ä—É–±.");
            }
        });
        
        sellAllBtn.addEventListener('click', () => {
            if (gameState.grain >= 1) {
                const total = gameState.grain * 5;
                gameState.money += total;
                gameState.grain = 0;
                coinSound.currentTime = 0;
                coinSound.play();
                updateUI();
                saveGame();
                showMessage(`–ü—Ä–æ–¥–∞–Ω–æ –≤—Å—ë –∑–µ—Ä–Ω–æ –∑–∞ ${total} —Ä—É–±.`);
            }
        });
        
        upgradeSickleBtn.addEventListener('click', upgradeSickle);
        buyFenceBtn.addEventListener('click', buyFence);
        buyField2Btn.addEventListener('click', () => buyField(1));
        buyField3Btn.addEventListener('click', () => buyField(2));
        buyField4Btn.addEventListener('click', () => buyField(3));
        buyField5Btn.addEventListener('click', () => buyField(4));
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏–π –Ω–∞ –ø–æ–ª–µ
        function setupFieldTouchHandlers() {
            fieldsElements.forEach((field, index) => {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                field.removeEventListener('touchstart', handleTouchStart);
                field.removeEventListener('touchmove', handleTouchMove);
                field.removeEventListener('touchend', handleTouchEnd);
                field.removeEventListener('mousedown', handleMouseDown);
                field.removeEventListener('mousemove', handleMouseMove);
                field.removeEventListener('mouseup', handleMouseUp);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                field.addEventListener('touchstart', handleTouchStart);
                field.addEventListener('touchmove', handleTouchMove);
                field.addEventListener('touchend', handleTouchEnd);
                field.addEventListener('mousedown', handleMouseDown);
                field.addEventListener('mousemove', handleMouseMove);
                field.addEventListener('mouseup', handleMouseUp);
            });
        }
        
        function handleTouchStart(e) {
            if (gameState.currentField !== parseInt(this.dataset.index)) return;
            
            const touch = e.touches[0];
            const rect = this.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            
            processFieldAction(x, y);
        }
        
        function handleTouchMove(e) {
            if (gameState.currentField !== parseInt(this.dataset.index)) return;
            
            const touch = e.touches[0];
            const rect = this.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            
            processFieldAction(x, y);
            e.preventDefault();
        }
        
        function handleTouchEnd() {
            // –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º, –Ω–æ –Ω—É–∂–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã
        }
        
        function handleMouseDown(e) {
            if (gameState.currentField !== parseInt(this.dataset.index)) return;
            
            const rect = this.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            processFieldAction(x, y);
        }
        
        function handleMouseMove(e) {
            if (gameState.currentField !== parseInt(this.dataset.index)) return;
            if (e.buttons !== 1) return;
            
            const rect = this.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            processFieldAction(x, y);
        }
        
        function handleMouseUp() {
            // –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º, –Ω–æ –Ω—É–∂–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã
        }
        
        function processFieldAction(x, y) {
            if (!activeTool) return;
            
            if (activeTool === 'plant') {
                createWheat(x, y);
            } else {
                // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ–¥ —Ç–æ—á–∫–æ–π –∫–∞—Å–∞–Ω–∏—è/–∫–ª–∏–∫–∞
                const elements = document.elementsFromPoint(
                    x + this.getBoundingClientRect().left, 
                    y + this.getBoundingClientRect().top
                );
                
                // –ò—â–µ–º –ø—à–µ–Ω–∏—Ü—É —Å—Ä–µ–¥–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                const wheat = elements.find(el => el.classList && el.classList.contains('wheat'));
                
                if (wheat) {
                    if (activeTool === 'water') {
                        createWaterEffect(x, y, gameState.currentField);
                        waterWheat(wheat);
                    } else if (activeTool === 'sickle') {
                        harvestWheat(wheat);
                    }
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        loadGame();
        createFields();
        setupFieldTouchHandlers();
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∞—É–¥–∏–æ
        document.addEventListener('click', () => {
            if (gameState.musicOn && gameState.gameStarted) {
                bgMusic.play().catch(e => {
                    console.log("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É '–ú—É–∑—ã–∫–∞' –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è.");
                    gameState.musicOn = false;
                    musicBtn.textContent = 'üîá –ú—É–∑—ã–∫–∞ –í—ã–∫–ª';
                });
            }
        }, { once: true });
    </script>
</body>
</html>
